<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>My New Post | flbu blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="执行查询创建数据模型后，Django自动提供了一套API来实现数据库的增删改查，模型代码如下 1234567891011121314151617181920212223242526272829from django.db import modelsclass Blog(models.Model):    name = models.CharField(max_length=100)    tagl">
<meta property="og:type" content="article">
<meta property="og:title" content="My New Post">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2019&#x2F;11&#x2F;22&#x2F;My-New-Post&#x2F;index.html">
<meta property="og:site_name" content="flbu blog">
<meta property="og:description" content="执行查询创建数据模型后，Django自动提供了一套API来实现数据库的增删改查，模型代码如下 1234567891011121314151617181920212223242526272829from django.db import modelsclass Blog(models.Model):    name = models.CharField(max_length=100)    tagl">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-11-22T14:50:36.142Z">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="flbu blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">flbu blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-My-New-Post" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/22/My-New-Post/" class="article-date">
  <time datetime="2019-11-22T14:26:19.000Z" itemprop="datePublished">2019-11-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      My New Post
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="执行查询"><a href="#执行查询" class="headerlink" title="执行查询"></a>执行查询</h2><p>创建数据模型后，Django自动提供了一套API来实现数据库的增删改查，模型代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Blog</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    tagline = models.TextField()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    email = models.EmailField()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Entry</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    blog = models.ForeignKey(Blog, on_delete=models.CASCADE)</span><br><span class="line">    headline = models.CharField(max_length=<span class="number">255</span>)</span><br><span class="line">    body_text = models.TextField()</span><br><span class="line">    pub_date = models.DateField()</span><br><span class="line">    mod_date = models.DateField()</span><br><span class="line">    authors = models.ManyToManyField(Author)</span><br><span class="line">    n_comments = models.IntegerField()</span><br><span class="line">    n_pingbacks = models.IntegerField()</span><br><span class="line">    rating = models.IntegerField()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.headline</span><br></pre></td></tr></table></figure>

<a id="more"></a> 

<ul>
<li><p>创建对象</p>
<p>Django中一个模型就代表数据库中的一张表，模型类的实例代表数据库表中的一行记录。</p>
<p>创建一个对象进行初始化后，可调用save()保存到数据库中 ，可重写save()方法实现自定义保存</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> blog.models <span class="keyword">import</span> Blog</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = Blog(name=<span class="string">'Beatles Blog'</span>, tagline=<span class="string">'All the latest Beatles news.'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.save()</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改对象</p>
<p>修改后调用save()方法保存</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>b5.name = <span class="string">'New name'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b5.save()</span><br></pre></td></tr></table></figure>

<ul>
<li><p>保存ForeignKey和ManyToManyField字段</p>
<p>更新ForeignKey字段：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> blog.models <span class="keyword">import</span> Blog, Entry</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>entry = Entry.objects.get(pk=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cheese_blog = Blog.objects.get(name=<span class="string">"Cheddar Talk"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>entry.blog = cheese_blog</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>entry.save()</span><br></pre></td></tr></table></figure>

<p>更新ManyToManyField字段要调用add()方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> blog.models <span class="keyword">import</span> Author</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>joe = Author.objects.create(name=<span class="string">"Joe"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>entry.authors.add(joe)</span><br></pre></td></tr></table></figure>

<p>add()方法可一次传入多个参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">entry.authors.add(john, paul, george, ringo)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>检索对象</p>
<p>通过模型类的Manager来构建queryset，每个模型至少有一个Manager，默认名称是objects</p>
<ul>
<li><p>检索全部对象</p>
<p>all()方法返回全部对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all_entries = Entry.objects.all()</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过过滤器检索指导对象</p>
<p><code>filter(**kwargs)</code></p>
<p>返回一个新的 <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/querysets/#django.db.models.query.QuerySet" target="_blank" rel="noopener"><code>QuerySet</code></a>，包含的对象满足给定查询参数。</p>
<p><code>exclude(**kwargs)</code></p>
<p>返回一个新的 <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/querysets/#django.db.models.query.QuerySet" target="_blank" rel="noopener"><code>QuerySet</code></a>，包含的对象不满足给定查询参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Entry.objects.filter(pub_date__year=<span class="number">2006</span>) <span class="comment"># 筛选出满足条件的对象</span></span><br><span class="line">Entry.objects.exclude(pub_date__year=<span class="number">2006</span>) <span class="comment"># 筛选出不满足条件的对象</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>链式过滤器</p>
<p>queryset的结果还是返回一个新的queryset，所以可链式调用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.filter(</span><br><span class="line"><span class="meta">... </span>    headline__startswith=<span class="string">'What'</span></span><br><span class="line"><span class="meta">... </span>).exclude(</span><br><span class="line"><span class="meta">... </span>    pub_date__gte=datetime.date.today()</span><br><span class="line"><span class="meta">... </span>).filter(</span><br><span class="line"><span class="meta">... </span>    pub_date__gte=datetime.date(<span class="number">2005</span>, <span class="number">1</span>, <span class="number">30</span>)</span><br><span class="line"><span class="meta">... </span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>queryset都是惰性的</p>
<p>创建 <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/querysets/#django.db.models.query.QuerySet" target="_blank" rel="noopener"><code>QuerySet</code></a> 并不会引发任何数据库活动。你可以将一整天的过滤器都堆积在一起，Django 只会在 <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/querysets/#django.db.models.query.QuerySet" target="_blank" rel="noopener"><code>QuerySet</code></a> 被 计算 时执行查询操作 。</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>用get()获得单个对象</p>
<p>不同于filter()总是返回一个queryset，get()只会返回单个对象，当返回多个对象时Django 会抛出 <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/exceptions/#django.core.exceptions.MultipleObjectsReturned" target="_blank" rel="noopener"><code>MultipleObjectsReturned</code></a>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">one_entry = Entry.objects.get(pk=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>限制queryset条目数</p>
<p>利用python切片语法将queryset切成指定长度，等价于 SQL 的 <code>LIMIT</code> 和 <code>OFFSET</code> 子句 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回前5个对象</span></span><br><span class="line">Entry.objects.all()[:<span class="number">5</span>]</span><br><span class="line"><span class="comment"># 返回第6到10个对象</span></span><br><span class="line">Entry.objects.all()[<span class="number">5</span>:<span class="number">10</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>字段查询</p>
<p>字段查询即你如何制定 SQL <code>WHERE</code> 子句。 它们以关键字参数的形式传递给 <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/querysets/#django.db.models.query.QuerySet" target="_blank" rel="noopener"><code>QuerySet</code></a> 方法 <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/querysets/#django.db.models.query.QuerySet.filter" target="_blank" rel="noopener"><code>filter()</code></a>， <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/querysets/#django.db.models.query.QuerySet.exclude" target="_blank" rel="noopener"><code>exclude()</code></a> 和 <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/querysets/#django.db.models.query.QuerySet.get" target="_blank" rel="noopener"><code>get()</code></a>。 </p>
<p>*<em>基本的查询关键字参数遵照 <code>field__lookuptype=value</code> *</em>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Entry.objects.filter(pub_date__lte=<span class="string">'2018-09-20'</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>| 转化成SQL语句大致是：</p>
<p>   SELECT * FROM blog_entry WHERE pub_date &lt;= ‘2018-09-20’;</p>
</blockquote>
</li>
<li><p>跨关系查询</p>
<p>要跨越关系，只需跨模型使用关联字段名，字段名由双下划线分割，直到拿到想要的字段。 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Entry.objecst.filter(blog__name=<span class="string">'flbu blog'</span>)</span><br></pre></td></tr></table></figure>

<p>反向操作也能行。要指向一个“反向的”关联关系，只需使用模型名的小写。 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Blog.objects.filter(entry__headline__contains=<span class="string">'Lennon'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>过滤器为模型指定字段</p>
<p>将模型字段与同一模型的另一字段作比较。</p>
<ul>
<li><p>F表达式</p>
<p>F()的实例充当查询字段的引用，这些引用可以实现在同一模型实例中比较不同的字段。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line">Entry.objects.filter(number_of_comments__gt=F(<span class="string">'number_of_pingbacks'</span>))</span><br></pre></td></tr></table></figure>

<p>Django支持对<code>F()</code>对象进行加减乘除求余和次方等数学运算，另一操作数既可以是常量，也可是另一F()对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Entry.objects.filter(number_of_comments__gt=F(<span class="string">'number_of_pingbacks'</span>) * <span class="number">2</span>)</span><br><span class="line">Entry.objects.filter(rating__lt=F(<span class="string">'number_of_comments'</span>) + F(<span class="string">'number_of_pingbacks'</span>))</span><br></pre></td></tr></table></figure>

<p><strong>也可以用双下划线在<code>F()</code>对象中进行跨关系查询</strong>，带有双下划线的 <code>F()</code> 对象将引入访问关联对象所需的任何连接 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Entry.objects.filter(authors__name=F(<span class="string">'blog__name'</span>))</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>主键(pk)查询快捷方式</p>
<p><code>pk</code> 表示主键 “primary key” 。</p>
<p>在示例Blog模型中，主键是id，所以以下查询等价</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Blog.objects.get(id__exact=<span class="number">14</span>) <span class="comment"># Explicit form</span></span><br><span class="line">Blog.objects.get(id=<span class="number">14</span>) <span class="comment"># __exact is implied</span></span><br><span class="line">Blog.objects.get(pk=<span class="number">14</span>) <span class="comment"># pk implies id__exact</span></span><br></pre></td></tr></table></figure>

<p><code>pk</code>的查询并不局限于<code>__exact</code>，任何的查询项都能接在<code>pk</code>的后面</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get blogs entries with id 1, 4 and 7</span></span><br><span class="line"> Blog.objects.filter(pk__in=[<span class="number">1</span>,<span class="number">4</span>,<span class="number">7</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get all blog entries with id &gt; 14</span></span><br><span class="line"> Blog.objects.filter(pk__gt=<span class="number">14</span>)</span><br></pre></td></tr></table></figure>

<p><code>pk</code>也支持跨连接</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Entry.objects.filter(blog__id__exact=<span class="number">3</span>) <span class="comment"># Explicit form</span></span><br><span class="line">Entry.objects.filter(blog__id=<span class="number">3</span>)        <span class="comment"># __exact is implied</span></span><br><span class="line">Entry.objects.filter(blog__pk=<span class="number">3</span>)        <span class="comment"># __pk implies __id__exact</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>通过Q对象完成复杂查询</p>
<p>在<code>filter()</code>中，查询使用的关键字参数使用AND连接，如果要执行更加复杂的查询，可以使用<code>Q</code>对象</p>
<p><code>Q</code> 对象能通过 <code>&amp;</code> 和 <code>|</code> 操作符连接起来。当操作符被用于两个 <code>Q</code> 对象之间时会生成一个新的 <code>Q</code> 对象。 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line">Q(question__startswith=<span class="string">'Who'</span>) | Q(question__startswith=<span class="string">'What'</span>)</span><br><span class="line"><span class="comment"># 等价于SQL WHERE 语句：WHERE question LIKE 'Who%' OR question LIKE 'What%'</span></span><br></pre></td></tr></table></figure>

<p><code>Q</code>对象可通过<code>~</code>反转，代表NOT</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Q(question__startswith=<span class="string">'Who'</span>) | ~Q(pub_date__year=<span class="number">2005</span>)</span><br></pre></td></tr></table></figure>

<p>每个查询函数可接受一个或多个<code>Q</code>对象作为位置参数，若提供了多个<code>Q</code>对象参数，这些参数会通过 “AND” 连接 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Poll.objects.get(</span><br><span class="line">    Q(question__startswith=<span class="string">'Who'</span>),</span><br><span class="line">    Q(pub_date=date(<span class="number">2005</span>, <span class="number">5</span>, <span class="number">2</span>)) | Q(pub_date=date(<span class="number">2005</span>, <span class="number">5</span>, <span class="number">6</span>))</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>查询函数可混合使用 <code>Q</code> 对象和关键字参数 ，均通过 “AND” 连接 。但<strong><code>Q</code> 对象必须位于所有关键字参数之前</strong>。 </p>
</li>
<li><p>比较对象总会使用主键值</p>
</li>
<li><p>删除对象</p>
<p>通过调用<code>delete()</code>方法删除对象，也可以通过<code>QuerySet</code>批量删除对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>e.delete()</span><br><span class="line"><span class="comment"># 返回被删除的对象数量和一个包含了每个被删除对象类型的数量的字典</span></span><br><span class="line">(<span class="number">1</span>, &#123;<span class="string">'weblog.Entry'</span>: <span class="number">1</span>&#125;)</span><br><span class="line"><span class="comment"># 删除QuerySet中的所有成员</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Entry.objects.filter(pub_date__year=<span class="number">2005</span>).delete()</span><br><span class="line">(<span class="number">5</span>, &#123;<span class="string">'webapp.Entry'</span>: <span class="number">5</span>&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>批量修改对象</p>
<p>可通过<code>update()</code>修改<code>QuerySet</code>中所有对象的一个字段，仅能用此方法设置非关联字段和 <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/fields/#django.db.models.ForeignKey" target="_blank" rel="noopener"><code>ForeignKey</code></a> 字段 </p>
<p>调用更新方法时也可以使用<code>F</code>表达式，但只能引用被更新模型的内部字段 。若在更新方法中使用 <code>F()</code> 对象的同时使用 join ，会抛出一个 <code>FieldError()</code> </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Entry.objects.all().update(number_of_pingbacks=F(<span class="string">'number_of_pingbacks'</span>) + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># This will raise a FieldError</span></span><br><span class="line"> Entry.objects.update(headline=F(<span class="string">'blog__name'</span>))</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联对象</p>
<p>一个 <code>Entry</code> 对象 <code>e</code> 通过 <code>blog</code> 属性可以获取其关联的 <code>Blog</code> 对象： <code>e.blog</code> ，一个 <code>Blog</code> 对象 <code>b</code> 能通过 <code>entry_set</code> 属性 <code>b.entry_set.all()</code> 访问包含所有关联 <code>Entry</code> 对象的列表 。</p>
<ul>
<li><p>一对多关联</p>
<ul>
<li><p>正向访问</p>
<p>对外键的修改直到你调用 <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/instances/#django.db.models.Model.save" target="_blank" rel="noopener"><code>save()</code></a> 后才会被存入数据库 </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">e = Entry.objects.get(id=<span class="number">2</span>)</span><br><span class="line">e.blog <span class="comment"># Returns the related Blog object</span></span><br><span class="line"></span><br><span class="line">e = Entry.objects.get(id=<span class="number">2</span>)</span><br><span class="line">e.blog = some_blog</span><br><span class="line">e.save()</span><br></pre></td></tr></table></figure>
</li>
<li><p>反向关联</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b = Blog,objects.get(pk=<span class="number">1</span>)</span><br><span class="line">b.entry_set.all()</span><br></pre></td></tr></table></figure>

<p>可以在定义 <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/fields/#django.db.models.ForeignKey" target="_blank" rel="noopener"><code>ForeignKey</code></a> 时设置 <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/fields/#django.db.models.ForeignKey.related_name" target="_blank" rel="noopener"><code>related_name</code></a> 参数重写这个 <code>FOO_set</code> 名。例如，若修改 <code>Entry</code> 模型为 <code>blog = ForeignKey(Blog, on_delete=models.CASCADE, related_name=&#39;entries&#39;)</code>，前文示例代码会看起来像这样 :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = Blog.objects.get(id=<span class="number">1</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.entries.all() <span class="comment"># Returns all Entry objects related to Blog.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># b.entries is a Manager that returns QuerySets.</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.entries.filter(headline__contains=<span class="string">'Lennon'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b.entries.count()</span><br></pre></td></tr></table></figure>
</li>
<li><p>管理关联对象的方法</p>
<ol>
<li><p><code>add(obj1, obj2, ...)</code></p>
<p>将特定的模型对象加入关联对象集合。</p>
</li>
<li><p><code>create(**kwargs)</code></p>
<p>创建一个新对象，保存，并将其放入关联对象集合中。返回新创建的对象。</p>
</li>
<li><p><code>remove(obj1, obj2, ...)</code></p>
<p>从关联对象集合删除指定模型对象.</p>
</li>
<li><p><code>clear()</code></p>
<p>从关联对象集合删除所有对象。</p>
</li>
<li><p><code>set(objs)</code></p>
<p>替换关联对象集合</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b = Blog.objects.get(id=<span class="number">1</span>)</span><br><span class="line">b.entry_set.set([e1, e2])</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
</li>
<li><p>多对多关联</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">e = Entry.objects.get(id=<span class="number">3</span>)</span><br><span class="line">e.authors.all() <span class="comment"># Returns all Author objects for this Entry.</span></span><br><span class="line">e.authors.count()</span><br><span class="line">e.authors.filter(name__contains=<span class="string">'John'</span>)</span><br><span class="line"></span><br><span class="line">a = Author.objects.get(id=<span class="number">5</span>)</span><br><span class="line">a.entry_set.all() <span class="comment"># Returns all Entry objects for this Author.</span></span><br></pre></td></tr></table></figure>

<p>和 <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/fields/#django.db.models.ForeignKey" target="_blank" rel="noopener"><code>ForeignKey</code></a> 一样， <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/fields/#django.db.models.ManyToManyField" target="_blank" rel="noopener"><code>ManyToManyField</code></a> 能指定 <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/fields/#django.db.models.ManyToManyField.related_name" target="_blank" rel="noopener"><code>related_name</code></a>。在上面的例子中，若 <code>Entry</code> 中的 <a href="https://docs.djangoproject.com/zh-hans/2.2/ref/models/fields/#django.db.models.ManyToManyField" target="_blank" rel="noopener"><code>ManyToManyField</code></a> 已指定了 <code>related_name=&#39;entries&#39;</code>，随后每个 <code>Author</code> 实例会拥有一个 <code>entries</code> 属性，而不是 <code>entry_set</code>。 </p>
</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/22/My-New-Post/" data-id="ck3a9m9rj0000sgug4v3iggb2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2019/11/22/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/11/22/My-New-Post/">My New Post</a>
          </li>
        
          <li>
            <a href="/2019/11/22/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 flbu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>